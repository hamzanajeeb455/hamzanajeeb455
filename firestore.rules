rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
  
  function hasAuthenticationAndWithinRequestAllowedTime() {
  	return request.auth != null && request.time < timestamp.date(2121, 12, 31);
  }
  // For signing up users
  match /users/{document} {
      allow read, write: if hasAuthenticationAndWithinRequestAllowedTime();
    }
  // For all future actions after signup
  match /users/{document=**} {
    allow read, write: if hasAuthenticationAndWithinRequestAllowedTime() 
        && exists(/databases/$(database)/documents/users/$(request.auth.uid));
  }
  
  // For all future actions after signup
  match /bridges/{document=**} {
    allow read, write: if hasAuthenticationAndWithinRequestAllowedTime() 
        && exists(/databases/$(database)/documents/users/$(request.auth.uid));
  }
  }
}